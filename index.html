<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>å­¸ç”Ÿé»æ•¸ç®¡ç†ç³»çµ± (GitHub ç‰ˆ)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-5" style="max-width: 600px;">
  <h2 class="text-center mb-4">ğŸ† å­¸ç”Ÿé»æ•¸æŸ¥è©¢èˆ‡ç®¡ç†</h2>

  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h5>ğŸ” é»æ•¸æŸ¥è©¢</h5>
      <div class="input-group">
        <input type="text" id="stuId" class="form-control" placeholder="è¼¸å…¥å­¸è™Ÿ">
        <button class="btn btn-primary" onclick="doAction('query')">æŸ¥è©¢</button>
      </div>
      <div id="queryResult" class="mt-3"></div>
    </div>
  </div>

  <div id="loginArea" class="card shadow-sm">
    <div class="card-body">
      <h5>ğŸ” ç®¡ç†å“¡ç™»å…¥</h5>
      <input type="password" id="adminPwd" class="form-control mb-2" placeholder="ç®¡ç†å¯†ç¢¼">
      <button class="btn btn-dark w-100" onclick="showAdmin()">é€²å…¥ç®¡ç†å¾Œå°</button>
    </div>
  </div>

  <div id="adminPanel" class="mt-4" style="display:none;">
    <div class="card border-danger mb-3">
      <div class="card-body text-center">
        <button class="btn btn-danger w-100 mb-2" onclick="doAction('batchUpdate')">â˜… çµ±ä¸€çµç®—æœ¬é€±é»æ•¸</button>
        <small class="text-muted">å°‡æœ¬é€±åŠ æ¸›åˆ†æ•¸ä½µå…¥ç¸½åˆ†ä¸¦æ­¸é›¶</small>
      </div>
    </div>

    <div class="card mb-3">
      <div class="card-body">
        <h6>ğŸ“¥ å¤§é‡åŒ¯å…¥åå–® (CSV)</h6>
        <textarea id="csvInput" class="form-control mb-2" rows="3" placeholder="å­¸è™Ÿ,å§“å,ç¸½åˆ†,æœ¬é€±åˆ†"></textarea>
        <button class="btn btn-success w-100" onclick="importCSV()">åŸ·è¡ŒåŒ¯å…¥</button>
      </div>
    </div>

    <div class="card mb-3">
      <div class="card-body">
        <h6>ğŸ”‘ ä¿®æ”¹å¯†ç¢¼</h6>
        <div class="input-group">
          <input type="text" id="newPwd" class="form-control">
          <button class="btn btn-outline-secondary" onclick="doAction('changePwd')">ä¿®æ”¹</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // ğŸ”— è«‹æ›¿æ›æˆä½ çš„ GAS ç¶²å€
  const GAS_URL = 'https://script.google.com/macros/s/AKfycbwrcE0v6gMKvhDWWU5Oa8Qz1_9_3xYJknmqSDXspSqHkHh4N35UbJ2O4AtOqTzLFOJu/exec';

  async function doAction(action) {
    const pwd = document.getElementById('adminPwd').value;
    const id = document.getElementById('stuId').value;
    const newPwd = document.getElementById('newPwd').value;
    
    let url = `${GAS_URL}?action=${action}&pwd=${pwd}`;
    if(action === 'query') url += `&id=${id}`;
    if(action === 'changePwd') url += `&newPwd=${newPwd}`;

    const res = await fetch(url);
    const data = await res.json();
    
    if (action === 'query') {
      const div = document.getElementById('queryResult');
      div.innerHTML = data.success ? `<div class="alert alert-success">${data.data.name} åŒå­¸ï¼š${data.data.points} é»</div>` : `<div class="alert alert-danger">${data.msg}</div>`;
    } else {
      alert(data.msg);
    }
  }

  async function importCSV() {
    const pwd = document.getElementById('adminPwd').value;
    const csv = document.getElementById('csvInput').value;
    const res = await fetch(GAS_URL, {
      method: 'POST',
      body: JSON.stringify({ action: 'import', pwd: pwd, csv: csv })
    });
    const data = await res.json();
    alert(data.msg);
  }

  function showAdmin() {
    document.getElementById('adminPanel').style.display = 'block';
    document.getElementById('loginArea').style.display = 'none';
  }
</script>
</body>
</html>
